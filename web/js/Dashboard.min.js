action_log_table={};$(function(){actionLogSearch();let end_date=new Date,begin_date=new Date,end_month,begin_month;end_date.setDate(end_date.getDate()-7);end_month=end_date.getMonth()+1;begin_month=begin_date.getMonth()+1;$("#datetimepicker_begin").datetimepicker({format:"YYYY-MM-DD",useCurrent:true,locale:"zh-TW",allowInputToggle:true});$("#datetimepicker_end").datetimepicker({format:"YYYY-MM-DD",useCurrent:true,locale:"zh-TW",allowInputToggle:true});$("#action-log-search").click(function(){actionLogSearch("day_limit")})});function actionLogSearch(limit_type="all"){let main_menu_id=$("#main-menu-id").val(),submit_data={main_menu_id:main_menu_id*1};if(limit_type==="day_limit"){let begin_date=$("#begin_date").val(),end_date=$("#end_date").val();submit_data={main_menu_id:main_menu_id*1,begin_date:begin_date,end_date:end_date}}$.ajax({type:"POST",url:"./?a=ActionLog&b=getActionLogList",data:submit_data,dataType:"json"}).then(function(result){if(!result["result"]){alert(result["message"]);return false}if(result["data"]["action_log_list"].length===0&&limit_type==="day_limit"){alert("查無資料!");$("#action-log-table-content").html('<tr><td colspan="7" class="text-center text-danger">查無資料!</td></tr>');return false}if(limit_type==="day_limit"){action_log_table.clear().destroy()}let user_list=result["data"]["user_list"],function_list=result["data"]["function_list"];$("#action-log-table-content").html("");$.each(result["data"]["action_log_list"],function(key,value){let template_value=[{main_menu:function_list[value["function_id"]]["parent_id"]?function_list[function_list[value["function_id"]]["parent_id"]]["name"]:function_list[value["function_id"]]["name"],second_menu:function_list[value["function_id"]]["parent_id"]?function_list[value["function_id"]]["name"]:"無",user_name:user_list[value["user_id"]]?user_list[value["user_id"]]["username"]:"未知使用者",action_type:actionTypeAssocArray[value["action_type"]]?actionTypeAssocArray[value["action_type"]]:value["action_type"],description:value["description"],created_at:value["created_at"]}];$("#action-log-table-content-template").tmpl(template_value).appendTo("#action-log-table-content")});action_log_table=$("#action-log-table").DataTable();return true})}